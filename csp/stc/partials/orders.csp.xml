<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="stc/partials/orders.csp" application="/csp/stc/" default="1"><![CDATA[

<div class="row-fluid">
	<div class="span1">
	</div>
	<div class="span10">
		<span ng-bind="'Заявки'|localize" style="font-weight: bold;"></span>
		<div class="btn-group pull-right">
			<button type="button" class="btn btn-mini btnRadio" ng-model="order.status" btn-radio="'All'"       ng-bind="'Все'|localize"></button>
			<button type="button" class="btn btn-mini btnRadio" ng-model="order.status" btn-radio="'New'"       ng-bind="'Новые'|localize"></button>
			<button type="button" class="btn btn-mini btnRadio" ng-model="order.status" btn-radio="'Approved'"  ng-bind="'Одобренные'|localize"></button>
			<button type="button" class="btn btn-mini btnRadio" ng-model="order.status" btn-radio="'Completed'" ng-bind="'Заполненные'|localize"></button>
			<button type="button" class="btn btn-mini btnRadio" ng-model="order.status" btn-radio="'Closed'"    ng-bind="'Закрытые'|localize"></button>
		</div>
	</div>
	<div class="span1">
	</div>
</div>
<div class="row-fluid">
	<div class="span1">
	</div>
	<div class="span10">
		<stcgrid
			grid="pageStore.orders.grid"
		    table-class="table table-bordered table-hover"
		    caption=""
		    columns="order.columns"
		    items="order.items"
		    properties="order.properties"
		    update-items="order.loadItems(pageCurr, pageSize, sqlName, isDown, searchSqlName, searchText)"

		    page-curr="order.pageCurr"
		    page-total="order.pageTotal"
		    page-size="order.pageSize"
		    navigator-visible="true"

		    selectable="true"
		    selected-items="order.selectedItems"
		    multi-select-mode="order.multiSelectMode"

		    action-column-visible="order.actionColumnVisible"
		    action-column-icon="'icon-ellipsis-horizontal'"
		    action-column-title=""
		    action-column-method=""

		    first-row-action-icon="'icon-eye-open'"
		    first-row-action-title="'Открыть заявку'|localize"
		    first-row-action-method="order.open(item)"
		    
		    second-row-action-icon="order.secondRowActionIcon"
		    second-row-action-title="'Удалить заявку'|localize"
		    second-row-action-method="order.deleteOrder(item)"
		    forcibly-update="order.forciblyUpdate"
		/>
	</div>
	<div class="span1">
	</div>
</div>

<div class="row-fluid" ng-show="order.selectedItems.length==0 || order.items.length==0">
	<div class="span1">
	</div>
	<div class="span10" style="text-align: center;">
		<i ng-bind="'Выберите заявку для отображения подробной информации.'|localize"></i>
	</div>
	<div class="span1">
	</div>
</div>	


<div class="row-fluid" ng-hide="order.selectedItems[0].status.code!='New' || order.selectedItems.length==0 || order.items==0">
	<div class="span1">
	</div>
	<div class="span10">
		 <tabset>
			<tab heading="{{'Информация'|localize}}">
				<div class="row-fluid">
					<div class="span6">
						<p><span class="spnTitle" ng-bind="'Организация'|localize"         ></span>: <span ng-bind="order.selectedItems[0].contact.company.shortName"></span>&nbsp;&nbsp;<span class="label label-important" ng-hide="order.selectedItems[0].contact.company.id" ng-bind="'Новая организация'|localize"></span></p>
						<p><span class="spnTitle" ng-bind="'Веб-сайт организации'|localize"></span>: <a target="_blank" style="text-decoration: none;" ng-href="{{'http://' + order.selectedItems[0].contact.company.site}}" title="{{order.selectedItems[0].contact.company.site}}"><i ng-bind="order.selectedItems[0].contact.company.site.substring(0,25)"></i></a></p>
						<div ng-show="order.contactType=='order' || (order.selectedItems[0].contact.company.contact.email==order.selectedItems[0].contact.email 
																	&& order.selectedItems[0].contact.company.contact.phone==order.selectedItems[0].contact.phone 
																	&& order.selectedItems[0].contact.company.contact.skype==order.selectedItems[0].contact.skype)">
							<p><span class="spnTitle" ng-bind="'Контакт'|localize"></span>: <span ng-bind="order.selectedItems[0].contact.lastName + ' ' + order.selectedItems[0].contact.firstName + ' ' + order.selectedItems[0].contact.middleName"></span></p>
							<p><span class="spnTitle" ng-bind="'Email'"           ></span>: <span ng-bind="order.selectedItems[0].contact.email"></span></p>
							<p><span class="spnTitle" ng-bind="'Телефон'|localize"></span>: <span ng-bind="order.selectedItems[0].contact.phone"></span></p>
							<p><span class="spnTitle" ng-bind="'Skype'"           ></span>: <span ng-bind="order.selectedItems[0].contact.skype"></span></p>
						</div>
						<div ng-show="order.contactType=='company' && !(order.selectedItems[0].contact.company.contact.email==order.selectedItems[0].contact.email 
																	&& order.selectedItems[0].contact.company.contact.phone==order.selectedItems[0].contact.phone 
																	&& order.selectedItems[0].contact.company.contact.skype==order.selectedItems[0].contact.skype)">
							<p><span class="spnTitle" ng-bind="'Контакт'|localize"></span>: <span ng-bind="order.selectedItems[0].contact.company.contact.lastName + ' ' + order.selectedItems[0].contact.company.contact.firstName + ' ' + order.selectedItems[0].contact.company.contact.middleName"></span></p>
							<p><span class="spnTitle" ng-bind="'Email'"           ></span>: <span ng-bind="order.selectedItems[0].contact.company.contact.email"></span></p>
							<p><span class="spnTitle" ng-bind="'Телефон'|localize"></span>: <span ng-bind="order.selectedItems[0].contact.company.contact.phone"></span></p>
							<p><span class="spnTitle" ng-bind="'Skype'"           ></span>: <span ng-bind="order.selectedItems[0].contact.company.contact.skype"></span></p>
						</div>
						<div ng-show="order.selectedItems[0].contact.company.id && !(order.selectedItems[0].contact.company.contact.email==order.selectedItems[0].contact.email 
																				 && order.selectedItems[0].contact.company.contact.phone==order.selectedItems[0].contact.phone 
																				 && order.selectedItems[0].contact.company.contact.skype==order.selectedItems[0].contact.skype 
																				 && order.selectedItems[0].contact.company.contact.lastName==order.selectedItems[0].contact.lastName 
																				 && order.selectedItems[0].contact.company.contact.firstName==order.selectedItems[0].contact.firstName 
																				 && order.selectedItems[0].contact.company.contact.middleName==order.selectedItems[0].contact.middleName)">
							<div ng-hide="menu.readOnlyMode" class="btn-group" ng-init="order.contactType='order'">
						        <button type="button" class="btn btn-small btnRadio" ng-model="order.contactType" btn-radio="'order'"   ng-bind="'Контакт из заявки'|localize"></button>
						        <button type="button" class="btn btn-small btnRadio" ng-model="order.contactType" btn-radio="'company'" ng-bind="'Контакт организации'|localize" ></button>
						    </div>	
							<button class="btn btn-small" ng-click="order.changeCompanyContact(false)" title="{{'Обновить контакт'|localize}}" ng-show="order.selectedItems[0].contact.company.contact.email==order.selectedItems[0].contact.email && !menu.readOnlyMode">&nbsp;<i class="icon-refresh"></i>&nbsp;</button>
							<button class="btn btn-small" ng-click="order.changeCompanyContact(true)"  title="{{'Заменить контакт'|localize}}" ng-show="order.selectedItems[0].contact.company.contact.email!=order.selectedItems[0].contact.email && !menu.readOnlyMode">&nbsp;<i class="icon-exchange"></i>&nbsp;</button>
						</div>
					</div>
					<div class="span6">
						<p><span class="spnTitle" ng-bind="'Курс'|localize"                 ></span>: <span ng-bind="order.selectedItems[0].course.name"></span></p>
						<p><span class="spnTitle" ng-bind="'Количество слушателей'|localize"></span>: <span ng-bind="order.selectedItems[0].studentsNumber"></span></p>
						<p><span class="spnTitle" ng-bind="'Дата создания'|localize"        ></span>: <span ng-bind="order.selectedItems[0].createdTS|convertCacheDate:('d MMMM y, HH:mm:ss'|localize)"></span></p>
						<button ng-hide="menu.readOnlyMode" class="btn btn-success btn-small" ng-click="order.accept()" 		ng-bind="'Принять заявку'|localize"></button>
						<button ng-hide="menu.readOnlyMode" class="btn btn-info btn-small"    ng-click="order.openChangeCompanyDialog()" ng-bind="'Сменить организацию'|localize"></button>
					</div>
				</div>
				
					</br>
			</tab>
		</tabset>
	</div>
	<div class="span1">
	</div>
</div>

<div class="row-fluid"  ng-hide="order.selectedItems[0].status.code=='New' || order.selectedItems.length==0 || order.items==0">
	<div class="span1">
	</div>
	<div class="span10">
		 <tabset>
			<tab heading="{{'Информация'|localize}}"  active="training.tabInfo">
				<div class="row-fluid">
					<div class="span6">
						<p><span class="spnTitle" ng-bind="'Организация'|localize"         ></span>: <span ng-bind="order.selectedItems[0].contact.company.shortName"></span></p>
						<p><span class="spnTitle" ng-bind="'Веб-сайт организации'|localize"></span>: <a target="_blank" style="text-decoration: none;" ng-href="{{'http://' + order.selectedItems[0].contact.company.site}}" title="{{order.selectedItems[0].contact.company.site}}"><i ng-bind="order.selectedItems[0].contact.company.site.substring(0,25)"></i></a></p>
						<p><span class="spnTitle" ng-bind="'Контакт'|localize"          ></span>: <span ng-bind="order.selectedItems[0].contact.lastName + ' ' + order.selectedItems[0].contact.firstName + ' ' + order.selectedItems[0].contact.middleName"></span></p>
						<p><span class="spnTitle" ng-bind="'Email'"                               ></span>: <span ng-bind="order.selectedItems[0].contact.email"></span></p>
						<p><span class="spnTitle" ng-bind="'Телефон'|localize"          ></span>: <span ng-bind="order.selectedItems[0].contact.phone"></span></p>
						<p><span class="spnTitle" ng-bind="'Skype'"                               ></span>: <span ng-bind="order.selectedItems[0].contact.skype"></span></p>
					</div>
					<div class="span6">
						<p><span class="spnTitle" ng-bind="'Курс'|localize"                 ></span>: <span ng-bind="order.selectedItems[0].course.name"></span></p>
						<p><span class="spnTitle" ng-bind="'Количество слушателей'|localize"></span>: <span ng-bind="order.selectedItems[0].studentsNumber"></span></p>
						<p><span class="spnTitle" ng-bind="'Дата создания'|localize"        ></span>: <span ng-bind="order.selectedItems[0].createdTS|convertCacheDate:('d MMMM y, HH:mm:ss'|localize)"></span></p>
						<button ng-show="order.selectedItems[0].status.code!='Closed' && !menu.readOnlyMode"   class="btn btn-info btn-small"    ng-click="order.openChangeCompanyDialog()" ng-bind="'Сменить организацию'|localize"></button>
						&nbsp;
						<button ng-show="order.selectedItems[0].status.code=='Approved' && !menu.readOnlyMode" class="btn btn-small"             ng-click="order.sendEmail()" title="{{'Отправить контакту повторно код доступа к заявке'|localize}}" ng-bind="'Отправить код'|localize"></button>
					</div>
				</div>
			</tab>
			<tab heading="{{'Заявки для обучения'|localize}}" disabled="order.selectedItems[0].status.code!='Completed'" active="training.tabOrders">
				<div class="row-fluid" ng-show="order.selectedItems.length==0">
					<i style="margin-left: 33%;" ng-bind="'Выберите заявки, слушатели которых войдут в обучение.'|localize"></i>
				</div>
				<div ng-hide="order.selectedItems.length==0">
					<stcgrid
					    table-class="table table-bordered"
					    caption="Выбранные заявки"
					    columns="training.orderColumns"
					    items="training.orders"
					    properties="order.properties"
					    update-items=""

					    page-curr="1"
					    page-total="1"
					    page-size="100"
					    navigator-visible="false"

					    selectable="false"
					    selected-items="training.selectedOrderItems"
					    multi-select-mode="false"

					    action-column-visible="false"
					   
					/>
				    <stcgrid
					    table-class="table table-bordered"
					    caption="Слушатели из заявок"
					    columns="training.studentColumns"
					    items="training.studentItems"
					    properties="training.studentProperties"
					    update-items=""

					    page-curr="1"
					    page-total="1"
					    page-size="100"
					    navigator-visible="false"

					    selectable="false"
					    selected-items="training.selectedStudentItems"
					    multi-select-mode="false"

					    action-column-visible="false"
					/>
					<accordion close-others="true">
						<accordion-group heading="{{'Создать обучение'|localize}}" is-open="training.accordionCreate">
					    	<form style="margin: 0 0 10px 0;" ng-submit="training.create()">
								<stctraining training="training.data" date-start="training.dateStart" date-finish="training.dateFinish" edit-mode="false" lang="menu.lang"/>
							</form>
					    </accordion-group>
					    <accordion-group heading="{{'Добавить в обучение'|localize}}" is-open="training.accordionAdd">
					    	<div ng-show="training.accordionAdd">
					    	 <stcgrid
							    table-class="table table-bordered table-hover"
							    caption=""
							    columns="training.columns"
							    items="training.items"
							    properties="training.properties"
							    update-items="training.loadItems(pageCurr, pageSize, sqlName, isDown, searchSqlName, searchText)"

							    page-curr="training.pageCurr"
							    page-total="training.pageTotal"
							    page-size="training.pageSize"
							    navigator-visible="true"

							    selectable="true"
							    selected-items="training.selectedItems"
							    multi-select-mode="training.multiSelectMode"

							    action-column-visible="false"
							/>
							</div>
							<button ng-hide="menu.readOnlyMode" class="btn btn-success btn-small" ng-click="training.add()" ng-disabled="training.selectedItems.length==0" ng-bind="'Добавить'|localize"></button>
					    </accordion-group>
					</accordion>
				</div>
			</tab>
		</tabset>
	</div>
	<div class="span1">
	</div>
</div>
</br>
<stcalert data="order.alert" span-right="1" span-middle="10" span-left="1"/>


<div class="modal" id="ChangeCompanyModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="ChangeCompanyModalLabel" aria-hidden="true" ng-show="order.modalChangeCompanyVisible">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"  ng-click="order.modalChangeCompanyVisible=false">×</button>
    <h3 id="ChangeCompanyModalLabel" ng-bind="'Сменить организацию в заявке'|localize"></h3>
  </div>
  <div class="modal-body">
	<form style="margin: 0 0 10px 0;" ng-submit="">
		<div class="row-fluid">
			<div class="control-group">
			    <label class="control-label" ng-bind="('Организация'|localize) + '*'"></label>
		        <div class="controls">
	            	<select class="span12" ng-model="order.newOrderCompany.id" ng-options="comp.id as comp.name for comp in order.companies"  required>
	            	</select>
		        </div>
			</div>
		</div>
		<button class="btn btn-success" data-dismiss="modal" aria-hidden="true" ng-click="order.changeCompany()" ng-bind="'Сменить'|localize"></button>
		<button class="btn" data-dismiss="modal" aria-hidden="true" ng-click="order.modalChangeCompanyVisible=false" ng-bind="'Отмена'|localize"></button>
	</form>
  </div>
</div>
]]></CSP>
</Export>
